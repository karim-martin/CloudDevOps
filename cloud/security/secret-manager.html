<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Secret Manager - Secure storage for sensitive data.">
  <title>Secret Manager | CloudDevOps</title>
  <link rel="stylesheet" href="../../assets/css/main.css">
  <link rel="icon" type="image/svg+xml" href="../../assets/images/logo.svg">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <header class="site-header"><div class="header-container"><a href="../../" class="logo"><img src="../../assets/images/logo.svg" alt=""><span>CloudDevOps</span></a><nav class="main-nav"><a href="../../devops/" class="nav-link">DevOps</a><a href="../../cloud/" class="nav-link active">Cloud</a><a href="../../app-deploy/" class="nav-link">App Deploy</a></nav><div class="header-actions"><button class="mobile-menu-toggle" aria-label="Open menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button></div></div></header>
  <div class="sidebar-overlay"></div>
  <div class="page-wrapper">
    <aside class="sidebar"><nav class="sidebar-nav">
      <div class="sidebar-section"><h3 class="sidebar-section-title">Security</h3><ul class="sidebar-links">
        <li><a href="./">Overview</a></li>
        <li><a href="./iam.html">IAM</a></li>
        <li><a href="./secret-manager.html" class="active">Secret Manager</a></li>
        <li><a href="./cloud-armor.html">Cloud Armor</a></li>
      </ul></div>
    </nav></aside>
    <main id="main-content" class="main-content">
      <article class="content-article">
        <header class="article-header"><h1>Secret Manager</h1></header>
        <div class="article-body">
          <p>Secret Manager stores API keys, passwords, certificates, and other sensitive data.</p>

          <h2>Create Secrets</h2>
          <pre><code class="language-bash"># Create secret
gcloud secrets create my-secret \
    --replication-policy="automatic"

# Add version with data
echo -n "my-secret-value" | gcloud secrets versions add my-secret --data-file=-

# Create secret with data in one command
echo -n "db-password" | gcloud secrets create db-password --data-file=-

# Create from file
gcloud secrets create tls-cert --data-file=./certificate.pem</code></pre>

          <h2>Access Secrets</h2>
          <pre><code class="language-bash"># Access latest version
gcloud secrets versions access latest --secret=my-secret

# Access specific version
gcloud secrets versions access 1 --secret=my-secret

# List versions
gcloud secrets versions list my-secret</code></pre>

          <h2>GKE Integration</h2>
          <pre><code class="language-yaml"># Option 1: External Secrets Operator
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: my-external-secret
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcp-secret-store
    kind: ClusterSecretStore
  target:
    name: my-k8s-secret
  data:
  - secretKey: password
    remoteRef:
      key: db-password</code></pre>

          <pre><code class="language-yaml"># Option 2: CSI Secret Store Driver
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: gcp-secrets
spec:
  provider: gcp
  parameters:
    secrets: |
      - resourceName: "projects/PROJECT_ID/secrets/db-password/versions/latest"
        path: "db-password"
---
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: app
    volumeMounts:
    - name: secrets
      mountPath: "/secrets"
      readOnly: true
  volumes:
  - name: secrets
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: gcp-secrets</code></pre>

          <h2>Cloud Run Integration</h2>
          <pre><code class="language-bash"># Mount secret as environment variable
gcloud run deploy my-service \
    --image=gcr.io/PROJECT/image \
    --set-secrets=DB_PASSWORD=db-password:latest

# Mount secret as file
gcloud run deploy my-service \
    --image=gcr.io/PROJECT/image \
    --set-secrets=/secrets/db-password=db-password:latest</code></pre>

          <pre><code class="language-yaml"># Cloud Run YAML
apiVersion: serving.knative.dev/v1
kind: Service
spec:
  template:
    spec:
      containers:
      - image: gcr.io/PROJECT/image
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              key: latest
              name: db-password</code></pre>

          <h2>Access in Code</h2>
          <pre><code class="language-csharp">// .NET
using Google.Cloud.SecretManager.V1;

var client = SecretManagerServiceClient.Create();
var secretName = new SecretVersionName(projectId, "db-password", "latest");
var response = client.AccessSecretVersion(secretName);
var secret = response.Payload.Data.ToStringUtf8();</code></pre>

          <pre><code class="language-javascript">// Node.js
const {SecretManagerServiceClient} = require('@google-cloud/secret-manager');
const client = new SecretManagerServiceClient();

const [version] = await client.accessSecretVersion({
  name: `projects/${projectId}/secrets/db-password/versions/latest`,
});
const secret = version.payload.data.toString();</code></pre>

          <h2>Secret Rotation</h2>
          <pre><code class="language-bash"># Add new version (automatic rotation)
echo -n "new-password" | gcloud secrets versions add db-password --data-file=-

# Disable old version
gcloud secrets versions disable 1 --secret=db-password

# Destroy old version (cannot be undone)
gcloud secrets versions destroy 1 --secret=db-password</code></pre>

          <h2>IAM for Secrets</h2>
          <pre><code class="language-bash"># Grant access to service account
gcloud secrets add-iam-policy-binding db-password \
    --member="serviceAccount:my-sa@PROJECT.iam.gserviceaccount.com" \
    --role="roles/secretmanager.secretAccessor"

# View secret IAM policy
gcloud secrets get-iam-policy db-password</code></pre>

          <h2>Common Commands</h2>
          <pre><code class="language-bash"># List secrets
gcloud secrets list

# Describe secret
gcloud secrets describe my-secret

# Delete secret
gcloud secrets delete my-secret

# Update secret labels
gcloud secrets update my-secret --update-labels=env=prod</code></pre>
        </div>
      </article>
    </main>
  </div>
  <footer class="site-footer"><div class="footer-container"><p class="copyright">CloudDevOps</p></div></footer>
  <script src="../../assets/js/navigation.js"></script><script src="../../assets/js/main.js"></script>
</body>
</html>
